<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Google Login</title>
</head>
<body>

<h3>Обробка входу через Google…</h3>

<script>
(function () {
    // Google повертає token у hash (#)
    const hash = window.location.hash.substring(1);
    const params = new URLSearchParams(hash);

    const accessToken = params.get("access_token");

    if (!accessToken) {
        document.body.innerHTML = "❌ Помилка авторизації Google";
        return;
    }

    // Надсилаємо токен у n8n
    fetch("https://n8n.narodocnt.online/webhook/google-login", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            access_token: accessToken
        })
    })
    .then(res => res.json())
    .then(data => {
        console.log("n8n response:", data);

        // можна зберігати сесію
        localStorage.setItem("user", JSON.stringify(data));

        // редірект назад на сайт
        window.location.href = "/";
    })
    .catch(err => {
        console.error(err);
        document.body.innerHTML = "❌ Помилка зв’язку з сервером";
    });
})();
</script>

</body>
</html>
