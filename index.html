/**
 * cheruta.js - Фінальна версія з фіксом накладання
 */

function initRutaUI() {
    const banner = document.querySelector('.ruta-container');
    if (!banner) return;

    // Очищення старого інтерфейсу
    const oldUI = document.getElementById('ruta-ui-layer');
    if (oldUI) oldUI.remove();

    const uiHtml = `
    <div id="ruta-ui-layer" style="
        position: absolute; 
        bottom: 0; 
        left: 0; 
        width: 100%; 
        background: linear-gradient(to top, rgba(0,0,0,0.9) 40%, transparent);
        display: flex; 
        align-items: center; 
        justify-content: space-between;
        padding: 10px 10px; 
        box-sizing: border-box; 
        z-index: 999;
    ">
        <div style="flex: 1; display: flex; justify-content: flex-start;">
            <button onclick="window.open('https://narodocnt.online/polozhennya.pdf', '_blank')" 
                style="background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 6px 10px; border-radius: 6px; font-size: 10px; font-weight: bold; cursor: pointer; white-space: nowrap;">
                ПОЛОЖЕННЯ
            </button>
        </div>

        <div id="ruta-timer-display" style="display: flex; gap: 5px; color: #f1c40f; text-align: center; flex: 1; justify-content: center;">
            <div class="t-u"><b id="d-val" style="display:block; font-size:16px;">00</b><small style="font-size:7px; color:white; text-transform:uppercase;">дн</small></div>
            <div class="t-u"><b id="h-val" style="display:block; font-size:16px;">00</b><small style="font-size:7px; color:white; text-transform:uppercase;">год</small></div>
            <div class="t-u"><b id="m-val" style="display:block; font-size:16px;">00</b><small style="font-size:7px; color:white; text-transform:uppercase;">хв</small></div>
            <div class="t-u"><b id="s-val" style="display:block; font-size:16px;">00</b><small style="font-size:7px; color:white; text-transform:uppercase;">сек</small></div>
        </div>

        <div style="flex: 1; display: flex; justify-content: flex-end;">
            <button onclick="goToGeneralForm()" 
                style="background: #ff4500; border: none; color: white; padding: 6px 10px; border-radius: 6px; font-size: 10px; font-weight: bold; cursor: pointer; white-space: nowrap;">
                ЗАЯВКА
            </button>
        </div>
    </div>
    `;

    banner.style.position = 'relative';
    banner.insertAdjacentHTML('beforeend', uiHtml);

    // Логіка відліку
    const target = new Date("March 21, 2026 09:00:00").getTime();

    const update = () => {
        const now = new Date().getTime();
        const diff = target - now;

        if (diff < 0) {
            document.getElementById("ruta-timer-display").innerHTML = "<b style='font-size:10px; color:white;'>РОЗПОЧАТО!</b>";
            return;
        }

        const d = Math.floor(diff / (1000 * 60 * 60 * 24));
        const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((diff % (1000 * 60)) / 1000);

        // Перевірка наявності елементів перед записом
        const dEl = document.getElementById("d-val");
        const hEl = document.getElementById("h-val");
        const mEl = document.getElementById("m-val");
        const sEl = document.getElementById("s-val");

        if (dEl) dEl.innerText = d.toString().padStart(2, '0');
        if (hEl) hEl.innerText = h.toString().padStart(2, '0');
        if (mEl) mEl.innerText = m.toString().padStart(2, '0');
        if (sEl) sEl.innerText = s.toString().padStart(2, '0');
    };

    setInterval(update, 1000);
    update();
}

// Викликаємо функцію, коли вікно завантажене
window.addEventListener('load', initRutaUI);
